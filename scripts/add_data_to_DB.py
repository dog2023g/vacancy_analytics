general_medium_salary_years = {2003: 20652, 2004: 21483, 2005: 26806, 2006: 35383, 2007: 37678, 2008: 40021, 2009: 37812,
                              2010: 36368, 2011: 36540, 2012: 36594, 2013: 38503, 2014: 37665, 2015: 40255, 2016: 42059,
                              2017: 45140, 2018: 51114, 2019: 52867, 2020: 54846, 2021: 62196, 2022: 66641, 2023: 71709,
                              2024: 78298}
general_count_vacancies_years = {2003: 1983, 2004: 7833, 2005: 16022, 2006: 33321, 2007: 53562, 2008: 75070,
                                 2009: 52889, 2010: 93494, 2011: 142458, 2012: 173897, 2013: 234019, 2014: 259571,
                                 2015: 284763, 2016: 332460, 2017: 391464, 2018: 517670, 2019: 535956, 2020: 611885,
                                 2021: 943151, 2022: 887542, 2023: 709545, 2024: 556742}
general_medium_salary_cities = {'Калинковичи': 1153792, 'Шахрисабз': 666955, 'Бар': 622852, 'Шри-Ланка': 496500,
                                'Шотландия': 415751, 'Моршин': 409405, 'Винники': 409405,
                                'Золочев (Львовская область)': 409405, 'Дубляны': 409405, 'Жолква': 409405,
                                'Жидачов': 409405, 'Глиняны': 409405, 'Добромиль': 409405,
                                'Виноградное (Калмыкия)': 402733, 'Бельгия': 381610, 'Япония': 379693, 'ЮАР': 342863,
                                'Германия': 338764, 'Алжир': 332149, 'Айет': 331730}
general_count_vacancies_cities = {'Москва': 0.338, 'Санкт-Петербург': 0.101, 'Минск': 0.035, 'Новосибирск': 0.024,
                                  'Екатеринбург': 0.022, 'Нижний Новгород': 0.021, 'Казань': 0.02, 'Киев': 0.02,
                                  'Алматы': 0.02, 'Воронеж': 0.016, 'Краснодар': 0.015, 'Самара': 0.013,
                                  'Ростов-на-Дону': 0.013, 'Пермь': 0.01, 'Уфа': 0.009, 'Челябинск': 0.008,
                                  'Красноярск': 0.008, 'Омск': 0.007, 'Саратов': 0.007, 'Волгоград': 0.006}
general_skills_years = {
    2015: {'JavaScript': 6702, 'ООП': 5146, 'jQuery': 5121, 'HTML5': 5003, 'HTML': 3791, 'C#': 3439, 'MVC': 3147,
           '.NET Framework': 3116, 'CSS': 3015, 'ASP.NET': 2998},
    2016: {'JavaScript': 13481, 'HTML': 9790, 'PHP': 8995, 'Git': 8450, 'Ведение переговоров': 8407, 'CSS': 8136,
           'jQuery': 7684, 'MySQL': 7591, 'Работа в команде': 7109, 'HTML5': 6756},
    2017: {'JavaScript': 20170, 'HTML': 14485, 'PHP': 12682, 'CSS': 12672, 'Git': 12584, 'MySQL': 11175,
           'Ведение переговоров': 10196, 'SQL': 9936, 'jQuery': 9708, 'HTML5': 8939},
    2018: {'JavaScript': 28103, 'HTML': 20174, 'Git': 19460, 'CSS': 17615, 'PHP': 17147, 'SQL': 16130, 'MySQL': 15693,
           'Ведение переговоров': 15266, 'Управление проектами': 13631, 'Работа в команде': 13214},
    2019: {'JavaScript': 31635, 'SQL': 25629, 'Git': 25126, 'HTML': 22114, 'Работа в команде': 20011,
           'Английский язык': 19672, 'CSS': 19579, 'Пользователь ПК': 18709, 'Linux': 18152,
           'Ведение переговоров': 18092},
    2020: {'SQL': 56764, 'Git': 45503, 'Английский язык': 43439, 'JavaScript': 41325, 'Работа в команде': 39109,
           'Пользователь ПК': 37617, 'Linux': 36571, 'Грамотная речь': 33868, 'Java': 30722, 'HTML': 28078},
    2021: {'Работа в команде': 96440, 'SQL': 96399, 'Английский язык': 86388, 'Грамотная речь': 77188, 'Git': 74292,
           'Пользователь ПК': 62068, 'JavaScript': 58612, 'Linux': 57973, 'Управление проектами': 51195,
           'Python': 49883},
    2022: {'Работа в команде': 92410, 'SQL': 89857, 'Английский язык': 70608, 'Git': 67732, 'Linux': 57900,
           'Пользователь ПК': 53027, 'Грамотная речь': 47851, 'Python': 47809, 'JavaScript': 45648,
           'Управление проектами': 45076},
    2023: {'SQL': 62368, 'Работа в команде': 45313, 'Linux': 41049, 'Git': 37744, 'Python': 35688,
           'Грамотная речь': 31817, 'PostgreSQL': 30432, 'Пользователь ПК': 28205, 'Английский язык': 27032,
           'Управление проектами': 26447},
    2024: {'SQL': 48119, 'Linux': 29619, 'Python': 27281, 'Git': 23616, 'PostgreSQL': 23539,
           'Аналитическое мышление': 20174, 'Техническая поддержка': 18671, 'JavaScript': 16223,
           'Работа с большим объемом информации': 15652, 'Настройка ПК': 15547}}

medium_salary_years = {2015: 53750, 2016: 61428, 2017: 71785, 2018: 63999, 2019: 55344, 2020: 51358, 2021: 85023,
                       2022: 110031, 2023: 64761, 2024: 103333}
count_vacancies_years = {2013: 1, 2014: 2, 2015: 10, 2016: 35, 2017: 25, 2018: 37, 2019: 53, 2020: 81, 2021: 122,
                         2022: 136, 2023: 62, 2024: 46}
medium_salary_cities = {'Минск': 172910, 'Калуга': 100000, 'Москва': 83979, 'Казань': 83750, 'Новосибирск': 81388,
                        'Екатеринбург': 74500, 'Санкт-Петербург': 74342, 'Краснодар': 72272, 'Пермь': 65000,
                        'Челябинск': 65000, 'Уфа': 65000, 'Ульяновск': 60000, 'Калининград': 60000, 'Таганрог': 55000,
                        'Нижний Новгород': 52083, 'Нур-Султан': 50451, 'Хабаровск': 47500, 'Владивосток': 47500,
                        'Тюмень': 46666, 'Воронеж': 45000}
count_vacancies_cities = {'Москва': 0.462, 'Санкт-Петербург': 0.208, 'Новосибирск': 0.059, 'Екатеринбург': 0.039,
                          'Краснодар': 0.028, 'Казань': 0.028, 'Нижний Новгород': 0.026, 'Киев': 0.015, 'Минск': 0.015,
                          'Ростов-на-Дону': 0.01, 'Вологда': 0.008, 'Воронеж': 0.008, 'Самара': 0.008,
                          'Волгоград': 0.007, 'Владивосток': 0.007, 'Тюмень': 0.007, 'Ярославль': 0.005,
                          'Саратов': 0.005, 'Тверь': 0.005, 'Алматы': 0.005}
skills_years = {
    2015: {'Devops': 1, 'Администрирование': 1, 'VPN': 1, 'Linux': 1, 'NoSQL': 1, 'Cisco': 1, 'HTTP': 1, 'Ruby': 1,
           'SQL': 1, 'Nginx': 1},
    2016: {'devops': 7, 'Bash': 6, 'Puppet': 6, 'chef': 6, 'Python': 5, 'docker': 5, 'Nginx': 5,
           'Администрирование серверов Linux': 5, 'Linux': 5, 'Perl': 4},
    2017: {'Nginx': 7, 'Администрирование серверов Linux': 7, 'Linux': 6, 'Puppet': 5, 'docker': 5, 'cloud': 5,
           'Unix Shell Scripts': 4, 'Unix': 4, 'Bash': 4, 'devops': 4},
    2018: {'Nginx': 12, 'Linux': 7, 'PHP': 7, 'Apache HTTP Server': 7, 'Bash': 6, 'Git': 6,
           'Администрирование серверов Linux': 5, 'Redis': 5, 'RabbitMQ': 5, 'Ruby On Rails': 5},
    2019: {'Linux': 6, 'Администрирование серверов Linux': 6, 'React': 6, 'Sass': 6, 'mobx-state-tree': 6,
           'TypeScript': 6, 'next.js': 6, 'devops': 6, 'CI/CD': 6, 'Nginx': 5},
    2020: {'Linux': 28, 'Nginx': 24, 'Администрирование серверов Linux': 21, 'MySQL': 21, 'Git': 20, 'Python': 18,
           'CentOS': 15, 'devops': 12, 'PostgreSQL': 12, 'Bash': 9},
    2021: {'Linux': 76, 'Docker': 40, 'PostgreSQL': 28, 'Python': 25, 'Ansible': 25, 'Git': 23, 'Nginx': 22,
           'Разработка платформы': 22, 'Bash': 21, 'Администрирование серверов Linux': 20},
    2022: {'Linux': 88, 'Kubernetes': 63, 'Docker': 63, 'Python': 58, 'Ansible': 49, 'Разработка платформы': 37,
           'Git': 28, 'Prometheus': 27, 'Bash': 27, 'Grafana': 21},
    2023: {'Linux': 19, 'CI/CD': 14, 'Docker': 12, 'Kubernetes': 11, 'Git': 9, 'PostgreSQL': 9, 'Ansible': 9,
           'Администрирование серверов Linux': 9, 'Gitlab': 9, 'Prometheus': 9},
    2024: {'Linux': 17, 'PostgreSQL': 10, 'Python': 9, 'Администрирование серверов Linux': 7, 'Zabbix': 7, 'Nginx': 6,
           'Docker': 5, 'Git': 5, 'PowerShell': 5, 'Grafana': 5}}


import os
import sys
import django


BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.insert(0, BASE_DIR)

os.environ.setdefault(
    'DJANGO_SETTINGS_MODULE',
    'vacancy_analytics.settings'
)

# 3. Инициализируем Django
django.setup()
from django.db import transaction
from main_vacancy_analytics.models import (
    GeneralSalariesYear, GeneralCountVacanciesYear, GeneralCitySalary,
    GeneralCityShare, GeneralSkillFrequency,
    SalariesYear, CountVacanciesYear, CitySalary,
    CityShare, SkillFrequency
)

@transaction.atomic
def reload_database():
    """
    Очистить все данные из таблиц и заполнить заново.
    """
    # Удаление всех записей
    for Model in [
        GeneralSalariesYear, GeneralCountVacanciesYear, GeneralCitySalary,
        GeneralCityShare, GeneralSkillFrequency,
        SalariesYear, CountVacanciesYear, CitySalary,
        CityShare, SkillFrequency
    ]:
        Model.objects.all().delete()

    # Заполнение общей статистики по годам
    for year, avg in general_medium_salary_years.items():
        GeneralSalariesYear.objects.create(year=year, average_salary=avg)
    for year, cnt in general_count_vacancies_years.items():
        GeneralCountVacanciesYear.objects.create(year=year, average_salary=cnt)

    # Заполнение общей статистики по городам
    for city, avg in general_medium_salary_cities.items():
        GeneralCitySalary.objects.create(city=city, average_salary=avg)
    for city, share in general_count_vacancies_cities.items():
        GeneralCityShare.objects.create(city=city, share=share)

    # Заполнение общей статистики навыков по годам
    for year, skills in general_skills_years.items():
        for skill, freq in skills.items():
            GeneralSkillFrequency.objects.create(year=year, skill=skill, frequency=freq)

    # Заполнение статистики для конкретной вакансии
    for year, avg in medium_salary_years.items():
        SalariesYear.objects.create(year=year, average_salary=avg)
    for year, cnt in count_vacancies_years.items():
        CountVacanciesYear.objects.create(year=year, average_salary=cnt)

    for city, avg in medium_salary_cities.items():
        CitySalary.objects.create(city=city, average_salary=avg)
    for city, share in count_vacancies_cities.items():
        CityShare.objects.create(city=city, share=share)

    for year, skills in skills_years.items():
        for skill, freq in skills.items():
            SkillFrequency.objects.create(year=year, skill=skill, frequency=freq)

    print("Database reloaded successfully.")

if __name__ == '__main__':
    reload_database()
